{% extends 'base.html' %}
{% load static %}
{% load filtro %}
{% block 'title' %} Empresas{% endblock%}
{% block 'head' %}
    <link href="{% static 'empresa/css/empresas.css' %}" rel="stylesheet"
{% endblock %}

{% block 'body' %}
    <div class="wrapper">
        <div class="box"> 
            <div class="header-box">
                {% if messages %}
                    {% for message in messages %}
                        <section class="alert {{message.tags}}">
                            {{message}}
                        </section>
                    {% endfor %}
                {% endif %}
                <h2 class="titulo">Gerenciar Empresas</h2>
                <a href="{% url 'nova_empresa' %}"><i class='bx bxs-message-square-add'></i></a>
            </div>
            <div class="borda-box"></div>
            <div class="body-box">           
                
                <form action="{% url 'empresas' %}" method="GET">
                    <div class="row">                    
                    
                        <div class="col-md-5">
                            <input  type="text" placeholder="Busque pelo nome" class="form-control" name="nome">
                        </div>

                        <div class="col-md-4">
                            <select id="id_tecnologias" class="form-select" name="tecnologias" multiple>                                
                                {% for tech in tecnologias %}
                                <option value="{{ tech.id }}" data-img-src="{{ tech.logo_tecn.url }}">
                                    {{ tech.tecnologia }}
                                </option>  
                                {% endfor %}                      
                            </select>
                        </div>

                        <div class="col-md-2">
                                <button type="submit" class="btn btn-lg btn-orange">
                                <i class="bx bx-search-alt"></i>                                
                                </button>
                        </div>

                    </div>
                </form>
                  

                <table class="tabela" cellpadding="20">
                    <tr>
                        <th>Logo</th>
                        <th>Nome</th>
                        <th>Cidade</th>
                        <th>UF</th>
                        <th>Tecnologias usadas</th>
                        <th>Quantidade de vagas</th>
                        <th>Ação</th>
                    </tr>

                        {% for empresa in empresas %}
                        <tr {% if not forloop.counter|is_par %} class="tabela-linha" {% endif %} >
                            <td width="20%">
                                <a href="{% url 'empresa_unica' empresa.id %}"><img width="30%" src="{{empresa.logo.url}}"></a>
                                
                            </td>
                            <td>
                                <a href="{% url 'empresa_unica' empresa.id %}">
                                {{empresa.nome}}
                                </a>
                            </td>
                            <td>{{empresa.cidade}}</td>
                            <td>{{empresa.estado}}</td>
                            <td>
                                
                                    {% for tech in empresa.tecnologias.all %}
                                        {% if forloop.counter <= 4 %}
                                            <img src="{{ tech.logo_tecn.url }}" alt="{{ tech.tecnologia }}" title="{{ tech.tecnologia }}" width="50" height="50">
                                        {% elif forloop.counter == 5 %}
                                            <br>
                                            <img src="{{ tech.logo_tecn.url }}" alt="{{ tech.tecnologia }}" title="{{ tech.tecnologia }}" width="50" height="50">
                                        {% else %}
                                            <img src="{{ tech.logo_tecn.url }}" alt="{{ tech.tecnologia }}" title="{{ tech.tecnologia }}" width="50" height="50" style="display:none;">
                                        {% endif %}
                                    {% endfor %}
                               
                            </td>
                            <td class="flag">
                                {% if empresa.qtd_vagas > 0 %}
                                    <img src="{% static 'empresa/img/flag_green.png' %}">
                                {% else %}
                                    <img src="{% static 'empresa/img/flag_red.png' %}">
                                {% endif %}
                                    &nbsp&nbsp{{empresa.qtd_vagas}}

                            </td>
                            <td>
                                <a href="{% url 'excluir_empresa' empresa.id %}" ><i class='bx bxs-message-square-x' style='color:#bf1b1d; font-size: 45px;'  ></i></a>
                                <a href="{% url 'editar_empresa' empresa.id %}" ><i class='bx bxs-message-square-edit' style='color:#1c6d62; font-size: 45px;'  ></i></a>
                                
                            </td>
                        </tr>
                        {% endfor %}
                </table>
            </div>


            

        </div>
    </div>

{% endblock%}